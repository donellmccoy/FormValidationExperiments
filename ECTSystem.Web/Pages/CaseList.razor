@page "/"
@attribute [Authorize]

<PageTitle>Cases - Electronic Case Tracking System</PageTitle>

<div>
@if (isLoading && cases == null)
{
    <RadzenStack Gap="1rem">
        <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center"
                      Style="margin-bottom: 1rem;">
            <RadzenSkeleton Style="width: 240px; height: 32px;" Animation="SkeletonAnimation.Wave" />
            <RadzenSkeleton Style="width: 130px; height: 36px; border-radius: 4px;" Animation="SkeletonAnimation.Wave" />
        </RadzenStack>
        <RadzenStack Gap="0" Style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.12); border-radius: 8px; padding: 1rem;">
            <RadzenSkeleton Style="width: 100%; height: 40px; margin-bottom: 0.75rem;" Animation="SkeletonAnimation.Wave" />
            @for (var i = 0; i < 5; i++)
            {
                <RadzenSkeleton Style="width: 100%; height: 36px; margin-bottom: 0.5rem;" Animation="SkeletonAnimation.Wave" />
            }
        </RadzenStack>
    </RadzenStack>
}
else
{

<RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center"
              Style="margin-bottom: 1rem;">
    <RadzenText TextStyle="TextStyle.H5" Style="font-weight: 700; color: rgba(255, 255, 255, 0.87); margin: 0;">
        Line Of Duty Cases
    </RadzenText>
    <RadzenButton Text="Create Case" Icon="add" ButtonStyle="ButtonStyle.Primary"
                  Variant="Variant.Outlined" Click="@OnCreateCase" />
</RadzenStack>

<RadzenDataGrid TItem="LineOfDutyCase"
                Data="@cases"
                Count="@count"
                LoadData="@LoadData"
                IsLoading="@isLoading"
                SelectionMode="DataGridSelectionMode.Single"
                AllowRowSelectOnRowClick="true"
                @bind-Value="_selectedCases"
                RowContextMenu="@((Action<DataGridRowMouseEventArgs<LineOfDutyCase>>)OnRowContextMenu)"
                AllowSorting="true"
                AllowFiltering="true"
                FilterMode="FilterMode.Simple"
                PageSize="10"
                AllowPaging="true"
                ShowPagingSummary="true"
                PagingSummaryFormat="@("Displaying page {0} of {1} ({2} records)")"
                PageSizeOptions="@(new[] { 5, 10, 25, 50 })"
                PagerHorizontalAlign="HorizontalAlign.Center"
                GridLines="DataGridGridLines.Both"
                Style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.12); border-radius: 8px;">
    <Columns>
        <RadzenDataGridColumn TItem="LineOfDutyCase" Property="CaseId" Title="Case ID" Width="180px">
            <Template Context="lodCase">
                <div class="case-id-cell">
                    <RadzenLink Path="@($"case/{lodCase.CaseId}")" Text="@lodCase.CaseId" />
                    <RadzenButton Icon="@(bookmarkedCaseIds.Contains(lodCase.Id) ? "bookmark_remove" : "bookmark_add")"
                                  ButtonStyle="ButtonStyle.Light"
                                  Variant="Variant.Text"
                                  Size="ButtonSize.ExtraSmall"
                                  class="bookmark-btn"
                                  Click="@(() => ToggleBookmark(lodCase))"
                                  title="@(bookmarkedCaseIds.Contains(lodCase.Id) ? "Remove Bookmark" : "Add Bookmark")" />
                </div>
            </Template>
        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="LineOfDutyCase" Property="ServiceNumber" Title="SSN" Width="120px" Filterable="false" Sortable="false">
            <Template Context="lodCase">
                @($"***-**-{lodCase.ServiceNumber[^4..]}")
            </Template>
        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="LineOfDutyCase" Property="MemberName" Title="Member" Width="220px" />
        <RadzenDataGridColumn TItem="LineOfDutyCase" Property="MemberRank" Title="Rank" Width="80px" TextAlign="TextAlign.Center"/>
        <RadzenDataGridColumn TItem="LineOfDutyCase" Property="Unit" Title="Unit"  />
        <RadzenDataGridColumn TItem="LineOfDutyCase" Property="IncidentDate" Title="Incident Date" FormatString="{0:yyyy-MM-dd}" />
        <RadzenDataGridColumn TItem="LineOfDutyCase" Property="ProcessType" Title="Process">
            <Template Context="lodCase">
                @FormatEnum(lodCase.ProcessType)
            </Template>
        </RadzenDataGridColumn>
    </Columns>
</RadzenDataGrid>

}
</div>
