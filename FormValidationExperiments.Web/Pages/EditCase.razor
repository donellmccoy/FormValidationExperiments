@page "/case/{CaseId}"

<PageTitle>Edit Case - LOD Case Management</PageTitle>

@if (isLoading)
{
    <div class="loading-container">
        <RadzenStack Gap="1.5rem">
            <RadzenSkeleton Style="width: 240px; height: 32px;" Animation="SkeletonAnimation.Wave" />
            <RadzenStack Orientation="Orientation.Horizontal" Gap="1rem" Style="height: 400px;">
                <RadzenSkeleton Style="width: 280px; height: 100%;" Animation="SkeletonAnimation.Wave" />
                <RadzenStack Gap="1rem" Style="flex: 1;">
                    <RadzenSkeleton Style="width: 100%; height: 120px;" Animation="SkeletonAnimation.Wave" />
                    <RadzenSkeleton Style="width: 100%; height: 280px;" Animation="SkeletonAnimation.Wave" />
                </RadzenStack>
            </RadzenStack>
        </RadzenStack>
    </div>
}
else
{
    <RadzenBreadCrumb Style="margin-bottom: 0.75rem;">
        <RadzenBreadCrumbItem Path="/" Text="Cases" />
        <RadzenBreadCrumbItem Text="@caseInfo.CaseNumber" />
    </RadzenBreadCrumb>

    <RadzenStack Orientation="Orientation.Horizontal" >
        @* ═══════════ Workflow Sidebar ═══════════ *@
        <WorkflowSidebar Steps="@workflowSteps" CurrentStepIndex="@currentStepIndex" OnStepClicked="@OnStepSelected" />

        @* ═══════════ Main Content ═══════════ *@
        <div class="assessment-main">
            @* ─── Case Info Card ─── *@
            <RadzenPanel AllowCollapse="false" 
                         Style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.12); border-radius: 8px; flex-shrink: 0; padding: 1.5rem;">
                <ChildContent>
                    <RadzenStack Orientation="Orientation.Horizontal" Gap="1.5rem" AlignItems="AlignItems.Start" Wrap="FlexWrap.Wrap">
                        <RadzenStack Gap="0.5rem" Style="flex: 1; min-width: 0;">
                            <RadzenStack Orientation="Orientation.Horizontal" Gap="0.75rem" AlignItems="AlignItems.Center" Wrap="FlexWrap.Wrap">
                                <RadzenText TextStyle="TextStyle.H6" Style="font-weight: 700; color: rgba(255, 255, 255, 0.87); margin: 0;">
                                    <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem" AlignItems="AlignItems.Center" Style="display: inline-flex;">
                                        <RadzenIcon Icon="assignment" Style="color: #5B9BD5; font-size: 24px;" />
                                        <span>Case Number: @caseInfo.CaseNumber</span>
                                    </RadzenStack>
                                </RadzenText>
                                <RadzenBadge Text="@caseInfo.Status" BadgeStyle="BadgeStyle.Info" Style="background-color: #00308F;" />
                            </RadzenStack>
                            <RadzenText TextStyle="TextStyle.Body1" Style="font-weight: 600; color: rgba(255, 255, 255, 0.70); margin: 0;">
                                Member: @caseInfo.Rank @caseInfo.MemberName
                            </RadzenText>
                            <RadzenStack Orientation="Orientation.Horizontal" Gap="2rem" Wrap="FlexWrap.Wrap" Style="font-size: 0.8rem; color: #8F8F8F;">
                                <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem" AlignItems="AlignItems.Center">
                                    <span class="material-symbols-outlined" style="font-size: 18px;">military_tech</span>
                                    <span>Rank: @caseInfo.Rank</span>
                                </RadzenStack>
                                <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem" AlignItems="AlignItems.Center">
                                    <span class="material-symbols-outlined" style="font-size: 18px;">groups</span>
                                    <span>Unit: @caseInfo.Unit</span>
                                </RadzenStack>
                                <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem" AlignItems="AlignItems.Center">
                                    <span class="material-symbols-outlined" style="font-size: 18px;">calendar_month</span>
                                    <span>Date of Injury: @caseInfo.DateOfInjury</span>
                                </RadzenStack>
                            </RadzenStack>
                        </RadzenStack>
                        <RadzenStack Gap="0.5rem">
                            <RadzenButton Variant="Variant.Text" Icon="print" ButtonStyle="ButtonStyle.Base" Size="ButtonSize.Small" title="Print Case" />
                            <RadzenButton Variant="Variant.Text" Icon="history" ButtonStyle="ButtonStyle.Base" Size="ButtonSize.Small" title="History" />
                        </RadzenStack>
                    </RadzenStack>
                </ChildContent>
            </RadzenPanel>

            @* ─── Assessment Panel ─── *@
            <RadzenPanel AllowCollapse="false" 
                         Style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.12); border-radius: 8px; overflow: hidden; display: flex; flex-direction: column; flex: 1; min-height: 0;">
                <HeaderTemplate>
                    <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center"
                                 Style="padding: 1rem 1.5rem 1rem 0.5rem;">
                        <RadzenStack Orientation="Orientation.Horizontal" Gap="0.75rem" AlignItems="AlignItems.Center">
                            <div class="panel-icon-box">
                                <span class="material-symbols-outlined">@CurrentStep?.Icon</span>
                            </div>
                            <RadzenText TextStyle="TextStyle.H6" Style="font-weight: 700; color: rgba(255, 255, 255, 0.87); margin: 0;">
                                @CurrentStep?.Name
                            </RadzenText>
                        </RadzenStack>
                    </RadzenStack>
                </HeaderTemplate>
                <ChildContent>
                    <RadzenTabs @bind-SelectedIndex="selectedTabIndex" Style="height: calc(100vh - 18rem);"
                    RenderMode="TabRenderMode.Client" TabPosition="TabPosition.Left" class="assessment-tabs">
                    <Tabs>
                        @* ─── Member Tab ─── *@
                        <RadzenTabsItem Text="Member">
                            <div class="rz-overflow-auto" style="height: 100%;">
                                <RadzenTemplateForm TItem="MemberInfoFormModel" Data="@memberFormModel" Submit="@OnMemberFormSubmit">

                                    @* ═══ Fieldset A: Items 1–3 — Request Information ═══ *@
                                    <RadzenFieldset Text="Request Information">
                                        <RadzenStack Gap="1rem">
                                            <RadzenRow Gap="1rem">
                                                <RadzenColumn Size="12" SizeMD="6">
                                                    <RadzenFormField Text="Requesting Commander" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenTextBox Value="@memberFormModel.RequestingCommander" @oninput="@(args => memberFormModel.RequestingCommander = args.Value?.ToString())" />
                                                    </RadzenFormField>
                                                </RadzenColumn>
                                                <RadzenColumn Size="12" SizeMD="6">
                                                    <RadzenFormField Text="Medical Provider" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenTextBox Value="@memberFormModel.MedicalProvider" @oninput="@(args => memberFormModel.MedicalProvider = args.Value?.ToString())" />
                                                    </RadzenFormField>
                                                </RadzenColumn>
                                            </RadzenRow>
                                            <RadzenRow Gap="1rem">
                                                <RadzenColumn Size="12" SizeMD="6">
                                                    <RadzenFormField Text="Report Date / Time" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenDatePicker @bind-Value="memberFormModel.ReportDate" ShowTime="true" Style="width: 100%;"
                                                                          DateFormat="MM/dd/yyyy HH:mm" />
                                                    </RadzenFormField>
                                                </RadzenColumn>
                                            </RadzenRow>
                                        </RadzenStack>
                                    </RadzenFieldset>

                                    @* ═══ Fieldset B: Items 4–6 — Member Identification ═══ *@
                                    <RadzenFieldset Text="Member Identification" class="rz-mt-4">
                                        <RadzenStack Gap="1rem">
                                            <RadzenRow Gap="1rem">
                                                <RadzenColumn Size="12" SizeMD="5">
                                                    <RadzenFormField Text="Last Name" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenTextBox Value="@memberFormModel.LastName" @oninput="@(args => memberFormModel.LastName = args.Value?.ToString())" />
                                                    </RadzenFormField>
                                                </RadzenColumn>
                                                <RadzenColumn Size="12" SizeMD="5">
                                                    <RadzenFormField Text="First Name" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenTextBox Value="@memberFormModel.FirstName" @oninput="@(args => memberFormModel.FirstName = args.Value?.ToString())" />
                                                    </RadzenFormField>
                                                </RadzenColumn>
                                                <RadzenColumn Size="12" SizeMD="2">
                                                    <RadzenFormField Text="MI" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenTextBox Value="@memberFormModel.MiddleInitial" @oninput="@(args => memberFormModel.MiddleInitial = args.Value?.ToString())" MaxLength="1" />
                                                    </RadzenFormField>
                                                </RadzenColumn>
                                            </RadzenRow>
                                            <RadzenRow Gap="1rem">
                                                <RadzenColumn Size="12" SizeMD="5">
                                                    <RadzenFormField Text="SSN (Last 4)" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenTextBox Value="@memberFormModel.SSN" @oninput="OnSsnChanged" MaxLength="4" Placeholder="____" />
                                                    </RadzenFormField>
                                                </RadzenColumn>
                                            </RadzenRow>

                                            <RadzenRow Gap="1rem">
                                                <RadzenColumn Size="12" SizeMD="5">
                                                    <RadzenFormField Text="Rank / Grade" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenDropDown @bind-Value="memberFormModel.Rank" TValue="MilitaryRank?"
                                                                        Data="@militaryRanks" Style="width: 100%;"
                                                                        Placeholder="Select Rank" AllowClear="true" />
                                                    </RadzenFormField>
                                                </RadzenColumn>
                                                <RadzenColumn Size="12" SizeMD="7">
                                                    <RadzenFormField Text="Organization / Unit" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenTextBox Value="@memberFormModel.OrganizationUnit" @oninput="@(args => memberFormModel.OrganizationUnit = args.Value?.ToString())" />
                                                    </RadzenFormField>
                                                </RadzenColumn>
                                            </RadzenRow>
                                        </RadzenStack>
                                    </RadzenFieldset>

                                    @* ═══ Fieldset C: Item 8 — Member Status ═══ *@
                                    <RadzenFieldset Text="Member Status" class="rz-mt-4">
                                        <RadzenStack Gap="0.75rem">
                                            <RadzenLabel Text="Select the member's status at the time of the incident:" />
                                            <RadzenRadioButtonList @bind-Value="memberFormModel.MemberStatus" TValue="MemberStatus?"
                                                                   Orientation="Orientation.Horizontal" class="radio-list-styled">
                                                <Items>
                                                    @foreach (var status in Enum.GetValues<MemberStatus>())
                                                    {
                                                        <RadzenRadioButtonListItem Text="@status.ToString()" Value="@((MemberStatus?)status)" />
                                                    }
                                                </Items>
                                            </RadzenRadioButtonList>
                                        </RadzenStack>
                                    </RadzenFieldset>

                                    @* ═══ Form Actions ═══ *@
                                    <div class="form-actions rz-mt-4">
                                        <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End">
                                            <RadzenSplitButton Click="@OnSplitButtonClick" Text="Apply Changes" Icon="save"
                                                               Variant="Variant.Flat" ButtonStyle="ButtonStyle.Primary"
                                                               Disabled="@(!memberFormModel.IsDirty)">
                                                <ChildContent>
                                                    <RadzenSplitButtonItem Text="Revert Changes" Icon="undo" Value="revert" />
                                                </ChildContent>
                                            </RadzenSplitButton>
                                        </RadzenStack>
                                        <hr style="border: none; border-top: 1px solid rgba(255, 255, 255, 0.12); margin: 0.75rem 0; width: 100%;" />
                                        <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center">
                                            <div class="next-step-hint">
                                                <span class="material-symbols-outlined">arrow_forward</span>
                                                <span>Next Step: <strong>Medical Assessment</strong></span>
                                            </div>
                                            <RadzenButton ButtonType="ButtonType.Submit" Text="Forward to Medical Officier" Style="background-color: #00308F; color: white;" />
                                        </RadzenStack>
                                    </div>

                                </RadzenTemplateForm>
                            </div>
                        </RadzenTabsItem>

                        @* ─── Medical Tab ─── *@
                        <RadzenTabsItem Text="Medical">
                            <div class="rz-overflow-auto" style="height: 100%;">
                                <RadzenTemplateForm TItem="MedicalAssessmentFormModel" Data="@formModel" Submit="@OnFormSubmit">

                                    @* ═══ Fieldset B: Item 9 — Type of Investigation ═══ *@
                                    <RadzenFieldset Text="Type of Investigation">
                                        <RadzenStack Gap="0.75rem">
                                            <RadzenLabel Text="Select the type of investigation:" />
                                            <RadzenRadioButtonList @bind-Value="formModel.InvestigationType" TValue="IncidentType?"
                                                                   Orientation="Orientation.Horizontal" class="radio-list-styled">
                                                <Items>
                                                    @foreach (var item in Enum.GetValues<IncidentType>())
                                                    {
                                                        <RadzenRadioButtonListItem Text="@item.ToDisplayString()" Value="@((IncidentType?)item)" />
                                                    }
                                                </Items>
                                            </RadzenRadioButtonList>
                                        </RadzenStack>
                                    </RadzenFieldset>

                                    @* ═══ Fieldset C: Item 10 — Treatment Facility ═══ *@
                                    <RadzenFieldset Text="Treatment Facility" class="rz-mt-4">
                                        <RadzenStack Gap="1rem">
                                            <div class="detail-section">
                                                <RadzenLabel Text="Was treatment at a military medical facility?" class="fieldset-label" />
                                                <RadzenRadioButtonList @bind-Value="formModel.IsMilitaryFacility" TValue="bool?"
                                                                       Orientation="Orientation.Horizontal" class="radio-list-styled">
                                                    <Items>
                                                        <RadzenRadioButtonListItem Text="Yes" Value="@((bool?)true)" />
                                                        <RadzenRadioButtonListItem Text="No" Value="@((bool?)false)" />
                                                    </Items>
                                                </RadzenRadioButtonList>
                                            </div>

                                            @if (formModel.IsMilitaryFacility == true)
                                            {
                                                <div class="conditional-section">
                                                    <RadzenFormField Text="Facility Name" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenTextBox Value="@formModel.TreatmentFacilityName" @oninput="@(args => formModel.TreatmentFacilityName = args.Value?.ToString())" />
                                                    </RadzenFormField>
                                                </div>
                                            }
                                        </RadzenStack>
                                    </RadzenFieldset>

                                    @* ═══ Fieldset D: Item 11 — Date/Time First Treated ═══ *@
                                    <RadzenFieldset Text="Date/Time First Treated" class="rz-mt-4">
                                        <RadzenRow Gap="1rem">
                                            <RadzenColumn Size="12" SizeMD="6">
                                                <RadzenFormField Text="Date and Time of First Treatment" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                    <RadzenDatePicker @bind-Value="formModel.TreatmentDateTime" ShowTime="true"
                                                                      DateFormat="MM/dd/yyyy HH:mm" Style="width: 100%;" />
                                                </RadzenFormField>
                                            </RadzenColumn>
                                        </RadzenRow>
                                    </RadzenFieldset>

                                    @* ═══ Fieldset E: Item 12 — Clinical Diagnosis ═══ *@
                                    <RadzenFieldset Text="Clinical Diagnosis" class="rz-mt-4">
                                        <RadzenStack Gap="1rem">
                                            <RadzenFormField Text="Clinical Diagnosis" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                <RadzenTextBox Value="@formModel.ClinicalDiagnosis" @oninput="@(args => formModel.ClinicalDiagnosis = args.Value?.ToString())" />
                                            </RadzenFormField>
                                            <RadzenFormField Text="Medical Findings" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                <RadzenTextArea Value="@formModel.MedicalFindings" @oninput="@(args => formModel.MedicalFindings = args.Value?.ToString())" Rows="4" Style="width: 100%;" />
                                            </RadzenFormField>
                                        </RadzenStack>
                                    </RadzenFieldset>

                                    @* ═══ Fieldset F: Items 13-14 — Medical Details ═══ *@
                                    <RadzenFieldset Text="Medical Details" class="rz-mt-4">
                                        <RadzenStack Gap="1.25rem">

                                            @* ── Item 13: Under the influence ── *@
                                            <div class="detail-section">
                                                <RadzenLabel Text="Was the member under the influence of drugs or alcohol?" class="fieldset-label" />
                                                <RadzenRadioButtonList @bind-Value="formModel.WasUnderInfluence" TValue="bool?"
                                                                       Orientation="Orientation.Horizontal" class="radio-list-styled">
                                                    <Items>
                                                        <RadzenRadioButtonListItem Text="Yes" Value="@((bool?)true)" />
                                                        <RadzenRadioButtonListItem Text="No" Value="@((bool?)false)" />
                                                    </Items>
                                                </RadzenRadioButtonList>
                                            </div>

                                            @if (ShowSubstanceType)
                                            {
                                                <div class="conditional-section">
                                                    <RadzenRow Gap="1rem">
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                                <RadzenRadioButtonList @bind-Value="formModel.SubstanceType" TValue="SubstanceType?"
                                                                                       Orientation="Orientation.Horizontal" class="radio-list-styled">
                                                                    <Items>
                                                                        @foreach (var item in Enum.GetValues<SubstanceType>())
                                                                        {
                                                                            <RadzenRadioButtonListItem Text="@item.ToDisplayString()" Value="@((SubstanceType?)item)" />
                                                                        }
                                                                    </Items>
                                                                </RadzenRadioButtonList>
                                                        </RadzenColumn>
                                                    </RadzenRow>
                                                </div>
                                            }

                                            @* ── Item 13a: Toxicology testing ── *@
                                            <div class="detail-section">
                                                <RadzenLabel Text="Was toxicology testing performed?" class="fieldset-label" />
                                                <RadzenRadioButtonList @bind-Value="formModel.ToxicologyTestDone" TValue="bool?"
                                                                       Orientation="Orientation.Horizontal" class="radio-list-styled">
                                                    <Items>
                                                        <RadzenRadioButtonListItem Text="Yes" Value="@((bool?)true)" />
                                                        <RadzenRadioButtonListItem Text="No" Value="@((bool?)false)" />
                                                    </Items>
                                                </RadzenRadioButtonList>
                                            </div>

                                            @if (ShowToxicologyResults)
                                            {
                                                <div class="conditional-section">
                                                    <RadzenFormField Text="Toxicology Test Results" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenTextArea Value="@formModel.ToxicologyTestResults" @oninput="@(args => formModel.ToxicologyTestResults = args.Value?.ToString())" Rows="3" Style="width: 100%;"/>
                                                    </RadzenFormField>
                                                </div>
                                            }

                                            @* ── Item 14: Mental responsibility ── *@
                                            <div class="detail-section">
                                                <RadzenLabel Text="Was the member mentally responsible at the time of the incident?" class="fieldset-label" />
                                                <RadzenRadioButtonList @bind-Value="formModel.WasMentallyResponsible" TValue="bool?"
                                                                       Orientation="Orientation.Horizontal" class="radio-list-styled">
                                                    <Items>
                                                        <RadzenRadioButtonListItem Text="Yes" Value="@((bool?)true)" />
                                                        <RadzenRadioButtonListItem Text="No" Value="@((bool?)false)" />
                                                    </Items>
                                                </RadzenRadioButtonList>
                                            </div>

                                            @* ── Item 14a: Psychiatric evaluation ── *@
                                            <div class="detail-section">
                                                <RadzenLabel Text="Was a psychiatric evaluation completed?" class="fieldset-label" />
                                                <RadzenRadioButtonList @bind-Value="formModel.PsychiatricEvalCompleted" TValue="bool?"
                                                                       Orientation="Orientation.Horizontal" class="radio-list-styled">
                                                    <Items>
                                                        <RadzenRadioButtonListItem Text="Yes" Value="@((bool?)true)" />
                                                        <RadzenRadioButtonListItem Text="No" Value="@((bool?)false)" />
                                                    </Items>
                                                </RadzenRadioButtonList>
                                            </div>

                                            @if (ShowPsychEvalDetails)
                                            {
                                                <div class="conditional-section">
                                                    <RadzenStack Orientation="Orientation.Vertical" Gap="1rem">
                                                        <RadzenFormField Text="Evaluation Date" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 50%;">
                                                            <RadzenDatePicker @bind-Value="formModel.PsychiatricEvalDate" ShowTime="true" Style="width: 100%;" DateFormat="MM/dd/yyyy HH:mm" />
                                                        </RadzenFormField>
                                                        <RadzenFormField Text="Evaluation Results" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                            <RadzenTextArea Value="@formModel.PsychiatricEvalResults" @oninput="@(args => formModel.PsychiatricEvalResults = args.Value?.ToString())" Rows="3" Style="width: 100%;" />
                                                        </RadzenFormField>
                                                    </RadzenStack>
                                                </div>
                                            }

                                            @* ── Item 14b: Other relevant conditions ── *@
                                            <div class="detail-section">
                                                <RadzenFormField Text="Other Relevant Medical Conditions" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                    <RadzenTextArea Value="@formModel.OtherRelevantConditions" @oninput="@(args => formModel.OtherRelevantConditions = args.Value?.ToString())" Rows="3" Style="width: 100%;" />
                                                </RadzenFormField>
                                            </div>

                                            @* ── Item 14c: Other tests ── *@
                                            <div class="detail-section">
                                                <RadzenLabel Text="Were other tests performed?" class="fieldset-label" />
                                                <RadzenRadioButtonList @bind-Value="formModel.OtherTestsDone" TValue="bool?"
                                                                       Orientation="Orientation.Horizontal" class="radio-list-styled">
                                                    <Items>
                                                        <RadzenRadioButtonListItem Text="Yes" Value="@((bool?)true)" />
                                                        <RadzenRadioButtonListItem Text="No" Value="@((bool?)false)" />
                                                    </Items>
                                                </RadzenRadioButtonList>
                                            </div>

                                            @if (ShowOtherTestDetails)
                                            {
                                                <div class="conditional-section">
                                                    <RadzenStack Orientation="Orientation.Vertical" Gap="1rem">
                                                        <RadzenFormField Text="Test Date" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 50%;">
                                                            <RadzenDatePicker @bind-Value="formModel.OtherTestDate" ShowTime="true" Style="width: 100%;" DateFormat="MM/dd/yyyy HH:mm" />
                                                        </RadzenFormField>
                                                        <RadzenFormField Text="Test Results" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                            <RadzenTextArea Value="@formModel.OtherTestResults" @oninput="@(args => formModel.OtherTestResults = args.Value?.ToString())" Rows="3" Style="width: 100%;" />
                                                        </RadzenFormField>
                                                    </RadzenStack>
                                                </div>
                                            }
                                        </RadzenStack>
                                    </RadzenFieldset>

                                    @* ═══ Fieldset G: Item 15 — EPTS / Service Aggravation ═══ *@
                                    <RadzenFieldset Text="EPTS / Service Aggravation" class="rz-mt-4 epts-fieldset">
                                        <RadzenStack Gap="1rem">
                                            <div class="epts-header">
                                                <RadzenLabel Text="Is this an Existed Prior to Service – Not Service Aggravated (EPTS-NSA) condition?" />
                                                <RadzenButton Variant="Variant.Text" Icon="help" ButtonStyle="ButtonStyle.Info" Size="ButtonSize.ExtraSmall"
                                                              title="EPTS-NSA requires informal LOD per DAFI 36-2910." />
                                            </div>
                                            <RadzenRadioButtonList @bind-Value="formModel.IsEptsNsa" TValue="bool?"
                                                                   Orientation="Orientation.Horizontal" class="radio-list-styled">
                                                <Items>
                                                    <RadzenRadioButtonListItem Text="Yes" Value="@((bool?)true)" />
                                                    <RadzenRadioButtonListItem Text="No" Value="@((bool?)false)" />
                                                </Items>
                                            </RadzenRadioButtonList>

                                            @if (ShowServiceAggravated)
                                            {
                                                <div class="conditional-section">
                                                    <RadzenLabel Text="Was the condition aggravated by military service?" class="fieldset-label" />
                                                    <RadzenRadioButtonList @bind-Value="formModel.IsServiceAggravated" TValue="bool?"
                                                                           Orientation="Orientation.Horizontal" class="radio-list-styled">
                                                        <Items>
                                                            <RadzenRadioButtonListItem Text="Yes" Value="@((bool?)true)" />
                                                            <RadzenRadioButtonListItem Text="No" Value="@((bool?)false)" />
                                                        </Items>
                                                    </RadzenRadioButtonList>
                                                </div>
                                            }

                                            <div class="detail-section">
                                                <RadzenLabel Text="Is the condition potentially unfitting for continued military service?" class="fieldset-label" />
                                                <RadzenRadioButtonList @bind-Value="formModel.IsPotentiallyUnfitting" TValue="bool?"
                                                                       Orientation="Orientation.Horizontal" class="radio-list-styled">
                                                    <Items>
                                                        <RadzenRadioButtonListItem Text="Yes" Value="@((bool?)true)" />
                                                        <RadzenRadioButtonListItem Text="No" Value="@((bool?)false)" />
                                                    </Items>
                                                </RadzenRadioButtonList>
                                            </div>
                                        </RadzenStack>
                                    </RadzenFieldset>

                                    @* ═══ Fieldset H: ARC-Specific (Reserve/Guard) ═══ *@
                                    @if (ShowArcSection)
                                    {
                                        <RadzenFieldset Text="ARC-Specific (Reserve / Guard)" class="rz-mt-4 arc-fieldset">
                                            <RadzenStack Gap="1rem">
                                                <div class="detail-section">
                                                    <RadzenLabel Text="Was the member at a deployed location at time of incident?" class="fieldset-label" />
                                                    <RadzenRadioButtonList @bind-Value="formModel.IsAtDeployedLocation" TValue="bool?"
                                                                           Orientation="Orientation.Horizontal" class="radio-list-styled">
                                                        <Items>
                                                            <RadzenRadioButtonListItem Text="Yes" Value="@((bool?)true)" />
                                                            <RadzenRadioButtonListItem Text="No" Value="@((bool?)false)" />
                                                        </Items>
                                                    </RadzenRadioButtonList>
                                                </div>

                                                @if (ShowArcSubFields)
                                                {
                                                    <div class="conditional-section">
                                                        <RadzenLabel Text="Does this case require an ARC board review?" class="fieldset-label" />
                                                        <RadzenRadioButtonList @bind-Value="formModel.RequiresArcBoard" TValue="bool?"
                                                                               Orientation="Orientation.Horizontal" class="radio-list-styled">
                                                            <Items>
                                                                <RadzenRadioButtonListItem Text="Yes" Value="@((bool?)true)" />
                                                                <RadzenRadioButtonListItem Text="No" Value="@((bool?)false)" />
                                                            </Items>
                                                        </RadzenRadioButtonList>
                                                    </div>
                                                }
                                            </RadzenStack>
                                        </RadzenFieldset>
                                    }

                                    @* ═══ Fieldset I: Medical Recommendation ═══ *@
                                    <RadzenFieldset Text="Medical Recommendation" class="rz-mt-4">
                                        <RadzenFormField Text="Medical Recommendation" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                            <RadzenTextArea Value="@formModel.MedicalRecommendation" @oninput="@(args => formModel.MedicalRecommendation = args.Value?.ToString())" Rows="5" Style="width: 100%;" />
                                        </RadzenFormField>
                                    </RadzenFieldset>

                                    @* ═══ Form Actions ═══ *@
                                    <div class="form-actions rz-mt-2">
                                        <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End">
                                            <RadzenSplitButton Click="@OnSplitButtonClick" Text="Apply Changes" Icon="save"
                                                               Variant="Variant.Flat" ButtonStyle="ButtonStyle.Primary"
                                                               Disabled="@(!formModel.IsDirty)">
                                                <ChildContent>
                                                    <RadzenSplitButtonItem Text="Revert Changes" Icon="undo" Value="revert" />
                                                </ChildContent>
                                            </RadzenSplitButton>
                                        </RadzenStack>
                                    </div>

                                    @* ═══ Fieldset J: Routing ═══ *@
                                    <RadzenFieldset Text="Routing" class="rz-mt-2 rz-mb-4">
                                        <RadzenStack Orientation="Orientation.Horizontal" Gap="1rem" AlignItems="AlignItems.Center">
                                            <RadzenSplitButton Click="@OnMedicalForwardClick" Text="Forward to Unit CC" Icon="send"
                                                               Style="background-color: #00308F; color: white;">
                                                <ChildContent>
                                                    <RadzenSplitButtonItem Text="Return to Med Tech" Icon="replay" Value="return" />
                                                    <RadzenSplitButtonItem Text="Cancel Investigation" Icon="cancel" Value="cancel" />
                                                </ChildContent>
                                            </RadzenSplitButton>
                                            <RadzenButton Text="Digitally Sign" Icon="edit_square" ButtonStyle="ButtonStyle.Success" />
                                        </RadzenStack>
                                    </RadzenFieldset>

                                </RadzenTemplateForm>
                            </div>
                        </RadzenTabsItem>

                        @* ─── Commander Review Tab ─── *@
                        <RadzenTabsItem Text="Commander Review">
                            <div class="rz-overflow-auto" style="height: 100%;">
                                <RadzenTemplateForm TItem="CommanderReviewFormModel" Data="@commanderFormModel" Submit="@OnCommanderFormSubmit">

                                    @* ═══ Fieldset A: Item 16 — Sources of Information ═══ *@
                                    <RadzenFieldset Text="Sources of Information">
                                        <RadzenStack Gap="0.75rem">
                                            <RadzenLabel Text="Select all sources of information reviewed for this determination:" />
                                            <RadzenStack Gap="0.5rem" Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center">
                                                <RadzenCheckBox @bind-Value="commanderFormModel.MemberStatementReviewed" Name="chkMemberStatement" />
                                                <RadzenLabel Text="Member's Written Statement" Component="chkMemberStatement" />
                                            </RadzenStack>
                                            <RadzenStack Gap="0.5rem" Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center">
                                                <RadzenCheckBox @bind-Value="commanderFormModel.MedicalRecordsReviewed" Name="chkMedicalRecords" />
                                                <RadzenLabel Text="Medical Records / Provider Assessment" Component="chkMedicalRecords" />
                                            </RadzenStack>
                                            <RadzenStack Gap="0.5rem" Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center">
                                                <RadzenCheckBox @bind-Value="commanderFormModel.WitnessStatementsReviewed" Name="chkWitness" />
                                                <RadzenLabel Text="Witness Statements" Component="chkWitness" />
                                            </RadzenStack>
                                            <RadzenStack Gap="0.5rem" Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center">
                                                <RadzenCheckBox @bind-Value="commanderFormModel.PoliceReportsReviewed" Name="chkPolice" />
                                                <RadzenLabel Text="Police / Security Forces Reports" Component="chkPolice" />
                                            </RadzenStack>
                                            <RadzenStack Gap="0.5rem" Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center">
                                                <RadzenCheckBox @bind-Value="commanderFormModel.CommanderReportReviewed" Name="chkCdrReport" />
                                                <RadzenLabel Text="Commander's Report of Investigation" Component="chkCdrReport" />
                                            </RadzenStack>
                                            <RadzenStack Gap="0.5rem" Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center">
                                                <RadzenCheckBox @bind-Value="commanderFormModel.OtherSourcesReviewed" Name="chkOther" />
                                                <RadzenLabel Text="Other" Component="chkOther" />
                                            </RadzenStack>

                                            @if (ShowOtherSourceDescription)
                                            {
                                                <div class="conditional-section">
                                                    <RadzenFormField Text="Describe Other Sources" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenTextBox Value="@commanderFormModel.OtherSourcesDescription" @oninput="@(args => commanderFormModel.OtherSourcesDescription = args.Value?.ToString())" />
                                                    </RadzenFormField>
                                                </div>
                                            }
                                        </RadzenStack>
                                    </RadzenFieldset>

                                    @* ═══ Fieldset B: Item 17 — Duty Status at Time of Incident ═══ *@
                                    <RadzenFieldset Text="Duty Status at Time of Incident" class="rz-mt-4">
                                        <RadzenStack Gap="0.75rem">
                                            <RadzenLabel Text="Select the member's duty status at the time of the injury / disease / death:" />
                                            <RadzenRadioButtonList @bind-Value="commanderFormModel.DutyStatusAtTime" TValue="DutyStatus?"
                                                                   Orientation="Orientation.Vertical" class="radio-list-styled">
                                                <Items>
                                                    @foreach (var status in Enum.GetValues<DutyStatus>())
                                                    {
                                                        <RadzenRadioButtonListItem Text="@status.ToDisplayString()" Value="@((DutyStatus?)status)" />
                                                    }
                                                </Items>
                                            </RadzenRadioButtonList>
                                        </RadzenStack>
                                    </RadzenFieldset>

                                    @* ═══ Fieldset C: Item 18 — Narrative of Circumstances ═══ *@
                                    <RadzenFieldset Text="Narrative of Circumstances" class="rz-mt-4">
                                        <RadzenStack Gap="1rem">
                                            <RadzenFormField Text="Brief Narrative" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                <RadzenTextArea Value="@commanderFormModel.NarrativeOfCircumstances" @oninput="@(args => commanderFormModel.NarrativeOfCircumstances = args.Value?.ToString())" Rows="6" Style="width: 100%;" />
                                            </RadzenFormField>
                                        </RadzenStack>
                                    </RadzenFieldset>

                                    @* ═══ Fieldset D: Item 19 — Misconduct Assessment ═══ *@
                                    <RadzenFieldset Text="Misconduct Assessment" class="rz-mt-4">
                                        <RadzenStack Gap="1rem">
                                            <div class="detail-section">
                                                <RadzenLabel Text="Did the injury, illness, disease, or death result from the member's own misconduct?" class="fieldset-label" />
                                                <RadzenRadioButtonList @bind-Value="commanderFormModel.ResultOfMisconduct" TValue="bool?"
                                                                       Orientation="Orientation.Horizontal" class="radio-list-styled">
                                                    <Items>
                                                        <RadzenRadioButtonListItem Text="Yes" Value="@((bool?)true)" />
                                                        <RadzenRadioButtonListItem Text="No" Value="@((bool?)false)" />
                                                    </Items>
                                                </RadzenRadioButtonList>
                                            </div>

                                            @if (ShowMisconductExplanation)
                                            {
                                                <div class="conditional-section">
                                                    <RadzenFormField Text="Misconduct Explanation" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenTextArea Value="@commanderFormModel.MisconductExplanation" @oninput="@(args => commanderFormModel.MisconductExplanation = args.Value?.ToString())" Rows="4" Style="width: 100%;" />
                                                    </RadzenFormField>
                                                </div>
                                            }
                                        </RadzenStack>
                                    </RadzenFieldset>

                                    @* ═══ Fieldset E: Item 20 — Proximate Cause ═══ *@
                                    <RadzenFieldset Text="Proximate Cause" class="rz-mt-4">
                                        <RadzenStack Gap="1rem">
                                            <RadzenFormField Text="Proximate Cause of Injury / Disease / Death" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                <RadzenTextArea Value="@commanderFormModel.ProximateCause" @oninput="@(args => commanderFormModel.ProximateCause = args.Value?.ToString())" Rows="4" Style="width: 100%;" />
                                            </RadzenFormField>
                                        </RadzenStack>
                                    </RadzenFieldset>

                                    @* ═══ Fieldset F: Item 21 — Commander's Recommendation ═══ *@
                                    <RadzenFieldset Text="Commander's Recommendation" class="rz-mt-4">
                                        <RadzenStack Gap="1rem">
                                            <RadzenLabel Text="Based on all available evidence, the commander recommends:" />
                                            <RadzenRadioButtonList @bind-Value="commanderFormModel.Recommendation" TValue="CommanderRecommendation?"
                                                                   Orientation="Orientation.Vertical" class="radio-list-styled">
                                                <Items>
                                                    <RadzenRadioButtonListItem Text="In Line of Duty (ILOD)" Value="@((CommanderRecommendation?)CommanderRecommendation.InLineOfDuty)" />
                                                    <RadzenRadioButtonListItem Text="Not In Line of Duty — Due to Own Misconduct" Value="@((CommanderRecommendation?)CommanderRecommendation.NotInLineOfDutyDueToMisconduct)" />
                                                    <RadzenRadioButtonListItem Text="Not In Line of Duty — Not Due to Own Misconduct" Value="@((CommanderRecommendation?)CommanderRecommendation.NotInLineOfDutyNotDueToMisconduct)" />
                                                    <RadzenRadioButtonListItem Text="Refer to Formal Investigation" Value="@((CommanderRecommendation?)CommanderRecommendation.ReferToFormalInvestigation)" />
                                                </Items>
                                            </RadzenRadioButtonList>

                                            <RadzenFormField Text="Recommendation Remarks" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                <RadzenTextArea Value="@commanderFormModel.RecommendationRemarks" @oninput="@(args => commanderFormModel.RecommendationRemarks = args.Value?.ToString())" Rows="3" Style="width: 100%;" />
                                            </RadzenFormField>
                                        </RadzenStack>
                                    </RadzenFieldset>

                                    @* ═══ Fieldset G: Items 22–23 — Commander Signature Block ═══ *@
                                    <RadzenFieldset Text="Commander Signature Block" class="rz-mt-4">
                                        <RadzenStack Gap="1rem">
                                            <RadzenRow Gap="1rem">
                                                <RadzenColumn Size="12" SizeMD="6">
                                                    <RadzenFormField Text="Commander Name" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenTextBox Value="@commanderFormModel.CommanderName" @oninput="@(args => commanderFormModel.CommanderName = args.Value?.ToString())" />
                                                    </RadzenFormField>
                                                </RadzenColumn>
                                                <RadzenColumn Size="12" SizeMD="6">
                                                    <RadzenFormField Text="Signature Date" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenDatePicker @bind-Value="commanderFormModel.CommanderSignatureDate" ShowTime="true" Style="width: 100%;"
                                                                          DateFormat="MM/dd/yyyy HH:mm" />
                                                    </RadzenFormField>
                                                </RadzenColumn>
                                            </RadzenRow>
                                            <RadzenRow Gap="1rem">
                                                <RadzenColumn Size="12" SizeMD="6">
                                                    <RadzenFormField Text="Rank / Grade" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenDropDown @bind-Value="commanderFormModel.CommanderRank" TValue="MilitaryRank?"
                                                                        Data="@militaryRanks" Style="width: 100%;"
                                                                        AllowClear="true" />
                                                    </RadzenFormField>
                                                </RadzenColumn>
                                                <RadzenColumn Size="12" SizeMD="6">
                                                    <RadzenFormField Text="Organization / Unit" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenTextBox Value="@commanderFormModel.CommanderOrganization" @oninput="@(args => commanderFormModel.CommanderOrganization = args.Value?.ToString())" />
                                                    </RadzenFormField>
                                                </RadzenColumn>
                                            </RadzenRow>
                                        </RadzenStack>
                                    </RadzenFieldset>

                                    @* ═══ Form Actions ═══ *@
                                    <div class="form-actions rz-mt-2">
                                        <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End">
                                            <RadzenSplitButton Click="@OnSplitButtonClick" Text="Apply Changes" Icon="save"
                                                               Variant="Variant.Flat" ButtonStyle="ButtonStyle.Primary"
                                                               Disabled="@(!commanderFormModel.IsDirty)">
                                                <ChildContent>
                                                    <RadzenSplitButtonItem Text="Revert Changes" Icon="undo" Value="revert" />
                                                </ChildContent>
                                            </RadzenSplitButton>
                                        </RadzenStack>
                                    </div>

                                    @* ═══ Routing ═══ *@
                                    <RadzenFieldset Text="Routing" class="rz-mt-2 rz-mb-4">
                                        <RadzenStack Orientation="Orientation.Horizontal" Gap="1rem" AlignItems="AlignItems.Center">
                                            <RadzenSplitButton Click="@OnCommanderForwardClick" Text="Forward to Wing JA" Icon="send"
                                                               Style="background-color: #00308F; color: white;">
                                                <ChildContent>
                                                    <RadzenSplitButtonItem Text="Return to Board Medical" Icon="replay" Value="return" />
                                                    <RadzenSplitButtonItem Text="Cancel Investigation" Icon="cancel" Value="cancel" />
                                                </ChildContent>
                                            </RadzenSplitButton>
                                            <RadzenButton Text="Digitally Sign" Icon="edit_square" ButtonStyle="ButtonStyle.Success" />
                                        </RadzenStack>
                                    </RadzenFieldset>

                                </RadzenTemplateForm>
                            </div>
                        </RadzenTabsItem>

                        @* ─── Legal Tab ─── *@
                        <RadzenTabsItem Text="Legal SJA Review">
                            <div class="rz-overflow-auto" style="height: 100%;">
                                <RadzenTemplateForm TItem="LegalSJAReviewFormModel" Data="@legalFormModel" Submit="@OnLegalFormSubmit">

                                    @* ═══ Fieldset A: Item 24 — Legal Sufficiency Review ═══ *@
                                    <RadzenFieldset Text="Legal Sufficiency Review">
                                        <RadzenStack Gap="1.25rem">
                                            <div class="detail-section">
                                                <RadzenLabel Text="Is the LOD determination package legally sufficient?" class="fieldset-label" />
                                                <RadzenRadioButtonList @bind-Value="legalFormModel.IsLegallySufficient" TValue="bool?"
                                                                       Orientation="Orientation.Horizontal" class="radio-list-styled">
                                                    <Items>
                                                        <RadzenRadioButtonListItem Text="Legally Sufficient" Value="@((bool?)true)" />
                                                        <RadzenRadioButtonListItem Text="Legally Insufficient" Value="@((bool?)false)" />
                                                    </Items>
                                                </RadzenRadioButtonList>
                                            </div>

                                            <div class="detail-section">
                                                <RadzenLabel Text="Do you concur with the commander's recommendation?" class="fieldset-label" />
                                                <RadzenRadioButtonList @bind-Value="legalFormModel.ConcurWithRecommendation" TValue="bool?"
                                                                       Orientation="Orientation.Horizontal" class="radio-list-styled">
                                                    <Items>
                                                        <RadzenRadioButtonListItem Text="Concur" Value="@((bool?)true)" />
                                                        <RadzenRadioButtonListItem Text="Non-Concur" Value="@((bool?)false)" />
                                                    </Items>
                                                </RadzenRadioButtonList>
                                            </div>

                                            @if (ShowNonConcurrenceReason)
                                            {
                                                <div class="conditional-section">
                                                    <RadzenFormField Text="Basis for Non-Concurrence" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenTextArea Value="@legalFormModel.NonConcurrenceReason" @oninput="@(args => legalFormModel.NonConcurrenceReason = args.Value?.ToString())" Rows="4" Style="width: 100%;" />
                                                    </RadzenFormField>
                                                </div>
                                            }
                                        </RadzenStack>
                                    </RadzenFieldset>

                                    @* ═══ Fieldset B: Item 25 — Legal Remarks ═══ *@
                                    <RadzenFieldset Text="Legal Remarks" class="rz-mt-4">
                                        <RadzenStack Gap="1rem">
                                            <RadzenFormField Text="SJA Remarks / Legal Opinion" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                <RadzenTextArea Value="@legalFormModel.LegalRemarks" @oninput="@(args => legalFormModel.LegalRemarks = args.Value?.ToString())" Rows="5" Style="width: 100%;" />
                                            </RadzenFormField>
                                        </RadzenStack>
                                    </RadzenFieldset>

                                    @* ═══ Fieldset C: SJA Signature Block ═══ *@
                                    <RadzenFieldset Text="SJA Signature Block" class="rz-mt-4">
                                        <RadzenStack Gap="1rem">
                                            <RadzenRow Gap="1rem">
                                                <RadzenColumn Size="12" SizeMD="6">
                                                    <RadzenFormField Text="SJA Name" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenTextBox Value="@legalFormModel.SJAName" @oninput="@(args => legalFormModel.SJAName = args.Value?.ToString())" />
                                                    </RadzenFormField>
                                                </RadzenColumn>
                                                <RadzenColumn Size="12" SizeMD="6">
                                                    <RadzenFormField Text="Signature Date" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenDatePicker @bind-Value="legalFormModel.SJASignatureDate" ShowTime="true" Style="width: 100%;"
                                                                          DateFormat="MM/dd/yyyy HH:mm" />
                                                    </RadzenFormField>
                                                </RadzenColumn>
                                            </RadzenRow>
                                            <RadzenRow Gap="1rem">
                                                <RadzenColumn Size="12" SizeMD="6">
                                                    <RadzenFormField Text="Rank / Grade" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenDropDown @bind-Value="legalFormModel.SJARank" TValue="MilitaryRank?"
                                                                        Data="@militaryRanks" Style="width: 100%;"
                                                                        AllowClear="true" />
                                                    </RadzenFormField>
                                                </RadzenColumn>
                                                <RadzenColumn Size="12" SizeMD="6">
                                                    <RadzenFormField Text="Organization / Unit" AllowFloatingLabel="false" Variant="Variant.Outlined" Style="width: 100%;">
                                                        <RadzenTextBox Value="@legalFormModel.SJAOrganization" @oninput="@(args => legalFormModel.SJAOrganization = args.Value?.ToString())" />
                                                    </RadzenFormField>
                                                </RadzenColumn>
                                            </RadzenRow>
                                        </RadzenStack>
                                    </RadzenFieldset>

                                    @* ═══ Form Actions ═══ *@
                                    <div class="form-actions rz-mt-2">
                                        <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End">
                                            <RadzenSplitButton Click="@OnSplitButtonClick" Text="Apply Changes" Icon="save"
                                                               Variant="Variant.Flat" ButtonStyle="ButtonStyle.Primary"
                                                               Disabled="@(!legalFormModel.IsDirty)">
                                                <ChildContent>
                                                    <RadzenSplitButtonItem Text="Revert Changes" Icon="undo" Value="revert" />
                                                </ChildContent>
                                            </RadzenSplitButton>
                                        </RadzenStack>
                                    </div>

                                    @* ═══ Routing ═══ *@
                                    <RadzenFieldset Text="Routing" class="rz-mt-2 rz-mb-4">
                                        <RadzenStack Orientation="Orientation.Horizontal" Gap="1rem" AlignItems="AlignItems.Center">
                                            <RadzenSplitButton Click="@OnLegalForwardClick" Text="Forward to Wing CC" Icon="send"
                                                               Style="background-color: #00308F; color: white;">
                                                <ChildContent>
                                                    <RadzenSplitButtonItem Text="Return to Unit CC" Icon="replay" Value="return" />
                                                    <RadzenSplitButtonItem Text="Cancel Investigation" Icon="cancel" Value="cancel" />
                                                </ChildContent>
                                            </RadzenSplitButton>
                                            <RadzenButton Text="Digitally Sign" Icon="edit_square" ButtonStyle="ButtonStyle.Success" />
                                        </RadzenStack>
                                    </RadzenFieldset>

                                </RadzenTemplateForm>
                            </div>
                        </RadzenTabsItem>

                        @* ─── Wing Tab ─── *@
                        <RadzenTabsItem Text="Wing CC Review">
                            <div class="rz-overflow-auto" style="height: 100%;">
                                <RadzenText TextStyle="TextStyle.Body1" Style="color: var(--rz-text-secondary-color);">
                                    Wing-level review and approval for this LOD case.
                                </RadzenText>

                                @* ═══ Form Actions ═══ *@
                                <div class="form-actions rz-mt-2">
                                    <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End">
                                        <RadzenSplitButton Click="@OnSplitButtonClick" Text="Apply Changes" Icon="save"
                                                           Variant="Variant.Flat" ButtonStyle="ButtonStyle.Primary"
                                                           Disabled="@(!HasAnyChanges)">
                                            <ChildContent>
                                                <RadzenSplitButtonItem Text="Revert Changes" Icon="undo" Value="revert" />
                                            </ChildContent>
                                        </RadzenSplitButton>
                                    </RadzenStack>
                                </div>

                                @* ═══ Routing ═══ *@
                                <RadzenFieldset Text="Routing" class="rz-mt-2 rz-mb-4">
                                    <RadzenStack Orientation="Orientation.Horizontal" Gap="1rem" AlignItems="AlignItems.Center">
                                        <RadzenSplitButton Click="@OnWingForwardClick" Text="Forward to Board Review" Icon="send"
                                                           Style="background-color: #00308F; color: white;">
                                            <ChildContent>
                                                <RadzenSplitButtonItem Text="Return to Wing JA" Icon="replay" Value="return" />
                                                <RadzenSplitButtonItem Text="Cancel Investigation" Icon="cancel" Value="cancel" />
                                            </ChildContent>
                                        </RadzenSplitButton>
                                        <RadzenButton Text="Digitally Sign" Icon="edit_square" ButtonStyle="ButtonStyle.Success" />
                                    </RadzenStack>
                                </RadzenFieldset>
                            </div>
                        </RadzenTabsItem>

                        @* ─── Board Tab ─── *@
                        <RadzenTabsItem Text="Board Review">
                            <div class="rz-overflow-auto" style="height: 100%;">
                                <RadzenText TextStyle="TextStyle.Body1" Style="color: var(--rz-text-secondary-color);">
                                    Board proceedings and findings for this LOD case.
                                </RadzenText>

                                @* ═══ Form Actions ═══ *@
                                <div class="form-actions rz-mt-2">
                                    <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End">
                                        <RadzenSplitButton Click="@OnSplitButtonClick" Text="Apply Changes" Icon="save"
                                                           Variant="Variant.Flat" ButtonStyle="ButtonStyle.Primary"
                                                           Disabled="@(!HasAnyChanges)">
                                            <ChildContent>
                                                <RadzenSplitButtonItem Text="Revert Changes" Icon="undo" Value="revert" />
                                            </ChildContent>
                                        </RadzenSplitButton>
                                    </RadzenStack>
                                </div>

                                @* ═══ Routing ═══ *@
                                <RadzenFieldset Text="Routing" class="rz-mt-2 rz-mb-4">
                                    <RadzenStack Orientation="Orientation.Horizontal" Gap="1rem" AlignItems="AlignItems.Center">
                                        <RadzenSplitButton Click="@OnBoardCompleteClick" Text="Complete Review" Icon="check_circle"
                                                           Style="background-color: #00308F; color: white;">
                                            <ChildContent>
                                                <RadzenSplitButtonItem Text="Return to Wing CC" Icon="replay" Value="return" />
                                                <RadzenSplitButtonItem Text="Cancel Investigation" Icon="cancel" Value="cancel" />
                                            </ChildContent>
                                        </RadzenSplitButton>
                                        <RadzenButton Text="Digitally Sign" Icon="edit_square" ButtonStyle="ButtonStyle.Success" />
                                    </RadzenStack>
                                </RadzenFieldset>
                            </div>
                        </RadzenTabsItem>

                        @* ─── Appeals Tab ─── *@
                        <RadzenTabsItem Text="Appeals">
                            <div class="rz-overflow-auto" style="height: 100%;">
                                <RadzenText TextStyle="TextStyle.Body1" Style="color: var(--rz-text-secondary-color);">
                                    Appeals and reconsideration requests.
                                </RadzenText>
                            </div>
                        </RadzenTabsItem>

                        @* ─── Case Dialogue Tab ─── *@
                        <RadzenTabsItem Text="Case Dialogue">
                            <div class="rz-overflow-auto" style="height: 100%;">
                                <RadzenText TextStyle="TextStyle.Body1" Style="color: var(--rz-text-secondary-color);">
                                    Case dialogue and communication thread between stakeholders.
                                </RadzenText>
                            </div>
                        </RadzenTabsItem>

                        @* ─── Notifications Tab ─── *@
                        <RadzenTabsItem Text="Notifications">
                            <div class="rz-overflow-auto" style="height: 100%;">
                                <RadzenText TextStyle="TextStyle.Body1" Style="color: var(--rz-text-secondary-color);">
                                    Notification records and delivery status.
                                </RadzenText>
                            </div>
                        </RadzenTabsItem>

                        @* ─── Documents Tab ─── *@
                        <RadzenTabsItem Text="Documents">
                            <div class="rz-overflow-auto" style="height: 100%;">
                                <RadzenText TextStyle="TextStyle.Body1" Style="color: var(--rz-text-secondary-color);">
                                    Upload and manage supporting documents for this LOD case.
                                </RadzenText>
                            </div>
                        </RadzenTabsItem>
                    </Tabs>
                </RadzenTabs>
                </ChildContent>
            </RadzenPanel>
        </div>
    </RadzenStack>
}
