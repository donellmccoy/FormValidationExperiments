@page "/workflow"

<PageTitle>LOD Case Workflow</PageTitle>

@if (isLoading)
{
    <div class="loading-card">
        <RadzenStack Gap="1.5rem">
            <RadzenSkeleton Style="width: 200px; height: 32px;" Animation="SkeletonAnimation.Wave" />
            <RadzenSkeleton Style="width: 100%; height: 48px;" Animation="SkeletonAnimation.Wave" />
            @for (int i = 0; i < 6; i++)
            {
                <RadzenStack Orientation="Orientation.Horizontal" Gap="1rem">
                    <RadzenSkeleton Style="width: 30%; height: 40px;" Animation="SkeletonAnimation.Wave" />
                    <RadzenSkeleton Style="width: 70%; height: 40px;" Animation="SkeletonAnimation.Wave" />
                </RadzenStack>
            }
        </RadzenStack>
    </div>
}
else
{
    <div class="workflow-container">
        <RadzenSteps @bind-SelectedIndex="selectedStepIndex" Change="@OnStepChange">
            <Steps>
                @* ═══════════════════ Step 1: Case Intake ═══════════════════ *@
                <RadzenStepsItem Text="Case Intake">
                    <div class="step-content">
                        <RadzenTabs @bind-SelectedIndex="step1TabIndex" RenderMode="TabRenderMode.Client">
                            <Tabs>
                                @* ───── Medical Tab ───── *@
                                <RadzenTabsItem Text="Medical" Icon="local_hospital">
                                    <div class="tab-content">
                                        <RadzenTemplateForm TItem="LODCase" Data="@lodCase" Submit="@OnSubmit">
                                            <RadzenFieldset Text="Case Information">
                                                <RadzenStack Gap="1rem">
                                                    <RadzenRow Gap="1rem">
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="Case ID" Style="width: 100%;">
                                                                <RadzenTextBox @bind-Value="lodCase.CaseId" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="Member Name" Style="width: 100%;">
                                                                <RadzenTextBox @bind-Value="lodCase.MemberName" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                    </RadzenRow>
                                                    <RadzenRow Gap="1rem">
                                                        <RadzenColumn Size="12" SizeMD="4">
                                                            <RadzenFormField Text="Rank" Style="width: 100%;">
                                                                <RadzenTextBox @bind-Value="lodCase.MemberRank" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="4">
                                                            <RadzenFormField Text="Service Number" Style="width: 100%;">
                                                                <RadzenTextBox @bind-Value="lodCase.ServiceNumber" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="4">
                                                            <RadzenFormField Text="Unit" Style="width: 100%;">
                                                                <RadzenTextBox @bind-Value="lodCase.Unit" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                    </RadzenRow>
                                                    <RadzenRow Gap="1rem">
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="Process Type" Style="width: 100%;">
                                                                <RadzenDropDown @bind-Value="lodCase.ProcessType" Data="@processTypes"
                                                                                TextProperty="Text" ValueProperty="Value" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="Component" Style="width: 100%;">
                                                                <RadzenDropDown @bind-Value="lodCase.Component" Data="@serviceComponents"
                                                                                TextProperty="Text" ValueProperty="Value" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                    </RadzenRow>
                                                </RadzenStack>
                                            </RadzenFieldset>

                                            <RadzenFieldset Text="Incident Details" class="rz-mt-4">
                                                <RadzenStack Gap="1rem">
                                                    <RadzenRow Gap="1rem">
                                                        <RadzenColumn Size="12" SizeMD="4">
                                                            <RadzenFormField Text="Incident Type" Style="width: 100%;">
                                                                <RadzenDropDown @bind-Value="lodCase.IncidentType" Data="@incidentTypes"
                                                                                TextProperty="Text" ValueProperty="Value" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="4">
                                                            <RadzenFormField Text="Incident Date" Style="width: 100%;">
                                                                <RadzenDatePicker @bind-Value="lodCase.IncidentDate" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="4">
                                                            <RadzenFormField Text="Duty Status" Style="width: 100%;">
                                                                <RadzenDropDown @bind-Value="lodCase.IncidentDutyStatus" Data="@dutyStatuses"
                                                                                TextProperty="Text" ValueProperty="Value" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                    </RadzenRow>
                                                    <RadzenFormField Text="Incident Description" Style="width: 100%;">
                                                        <RadzenTextArea @bind-Value="lodCase.IncidentDescription" Rows="4" Style="width: 100%;" />
                                                    </RadzenFormField>
                                                    <RadzenRow Gap="1rem">
                                                        <RadzenColumn Size="12" SizeMD="4">
                                                            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                                                                <RadzenCheckBox @bind-Value="lodCase.IsSexualAssaultCase" />
                                                                <RadzenLabel Text="Sexual Assault Case" />
                                                            </RadzenStack>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="4">
                                                            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                                                                <RadzenCheckBox @bind-Value="lodCase.RestrictedReporting" />
                                                                <RadzenLabel Text="Restricted Reporting" />
                                                            </RadzenStack>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="4">
                                                            <RadzenFormField Text="SARC Coordination" Style="width: 100%;">
                                                                <RadzenTextBox @bind-Value="lodCase.SARCCoordination" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                    </RadzenRow>
                                                </RadzenStack>
                                            </RadzenFieldset>

                                            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.5rem" class="rz-mt-4">
                                                <RadzenButton ButtonType="ButtonType.Submit" Text="Save" Icon="save" />
                                                <RadzenButton ButtonStyle="ButtonStyle.Light" Text="Reset" Icon="refresh" Click="@OnReset" />
                                            </RadzenStack>
                                        </RadzenTemplateForm>
                                    </div>
                                </RadzenTabsItem>

                                @* ───── Comments Tab ───── *@
                                <RadzenTabsItem Text="Comments" Icon="comment">
                                    <div class="tab-content">
                                        <RadzenTemplateForm TItem="CommentModel" Data="@currentComment" Submit="@OnCommentSubmit">
                                            <RadzenFieldset Text="Add Comment">
                                                <RadzenStack Gap="1rem">
                                                    <RadzenFormField Text="Comment" Style="width: 100%;">
                                                        <RadzenTextArea @bind-Value="currentComment.Text" Rows="4" Style="width: 100%;" Placeholder="Enter audit comment..." />
                                                    </RadzenFormField>
                                                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                                                        <RadzenCheckBox @bind-Value="lodCase.IsAudited" />
                                                        <RadzenLabel Text="Mark as Audited" />
                                                    </RadzenStack>
                                                    <RadzenFormField Text="Point of Contact" Style="width: 100%;">
                                                        <RadzenTextBox @bind-Value="lodCase.PointOfContact" Placeholder="e.g., AF/A1PP email" />
                                                    </RadzenFormField>
                                                </RadzenStack>
                                            </RadzenFieldset>
                                            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.5rem" class="rz-mt-4">
                                                <RadzenButton ButtonType="ButtonType.Submit" Text="Add Comment" Icon="add_comment" />
                                            </RadzenStack>
                                        </RadzenTemplateForm>

                                        @if (lodCase.AuditComments.Any())
                                        {
                                            <RadzenFieldset Text="Audit Comments" class="rz-mt-4">
                                                <RadzenDataList Data="@lodCase.AuditComments" TItem="string">
                                                    <Template Context="comment">
                                                        <RadzenCard Variant="Variant.Outlined" class="rz-mb-2">
                                                            <RadzenText TextStyle="TextStyle.Body2">@comment</RadzenText>
                                                        </RadzenCard>
                                                    </Template>
                                                </RadzenDataList>
                                            </RadzenFieldset>
                                        }
                                    </div>
                                </RadzenTabsItem>
                            </Tabs>
                        </RadzenTabs>
                    </div>
                </RadzenStepsItem>

                @* ═══════════════════ Step 2: Documentation ═══════════════════ *@
                <RadzenStepsItem Text="Documentation">
                    <div class="step-content">
                        <RadzenTabs @bind-SelectedIndex="step2TabIndex" RenderMode="TabRenderMode.Client">
                            <Tabs>
                                @* ───── Documents Tab ───── *@
                                <RadzenTabsItem Text="Documents" Icon="description">
                                    <div class="tab-content">
                                        <RadzenTemplateForm TItem="LODDocument" Data="@currentDocument" Submit="@OnDocumentSubmit">
                                            <RadzenFieldset Text="Add Document">
                                                <RadzenStack Gap="1rem">
                                                    <RadzenRow Gap="1rem">
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="Document Type" Style="width: 100%;">
                                                                <RadzenTextBox @bind-Value="currentDocument.DocumentType" Placeholder="e.g., AF Form 348, DD Form 261" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="File Name" Style="width: 100%;">
                                                                <RadzenTextBox @bind-Value="currentDocument.FileName" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                    </RadzenRow>
                                                    <RadzenRow Gap="1rem">
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="Upload Date" Style="width: 100%;">
                                                                <RadzenDatePicker @bind-Value="currentDocument.UploadDate" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="Description" Style="width: 100%;">
                                                                <RadzenTextBox @bind-Value="currentDocument.Description" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                    </RadzenRow>
                                                </RadzenStack>
                                            </RadzenFieldset>
                                            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.5rem" class="rz-mt-4">
                                                <RadzenButton ButtonType="ButtonType.Submit" Text="Add Document" Icon="add" />
                                            </RadzenStack>
                                        </RadzenTemplateForm>

                                        @if (lodCase.Documents.Any())
                                        {
                                            <RadzenFieldset Text="Existing Documents" class="rz-mt-4">
                                                <RadzenDataList Data="@lodCase.Documents" TItem="LODDocument">
                                                    <Template Context="doc">
                                                        <RadzenCard Variant="Variant.Outlined" class="rz-mb-2">
                                                            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
                                                                <RadzenStack Gap="0.25rem">
                                                                    <RadzenText TextStyle="TextStyle.Subtitle1"><strong>@doc.DocumentType</strong></RadzenText>
                                                                    <RadzenText TextStyle="TextStyle.Body2">@doc.FileName</RadzenText>
                                                                    <RadzenText TextStyle="TextStyle.Caption" Style="color: var(--rz-text-secondary-color);">@doc.Description</RadzenText>
                                                                </RadzenStack>
                                                                <RadzenBadge Text="@(doc.UploadDate?.ToString("d") ?? "No date")" BadgeStyle="BadgeStyle.Info" />
                                                            </RadzenStack>
                                                        </RadzenCard>
                                                    </Template>
                                                </RadzenDataList>
                                            </RadzenFieldset>
                                        }
                                    </div>
                                </RadzenTabsItem>

                                @* ───── Comments Tab ───── *@
                                <RadzenTabsItem Text="Comments" Icon="comment">
                                    <div class="tab-content">
                                        <RadzenTemplateForm TItem="CommentModel" Data="@currentComment" Submit="@OnCommentSubmit">
                                            <RadzenFieldset Text="Add Comment">
                                                <RadzenStack Gap="1rem">
                                                    <RadzenFormField Text="Comment" Style="width: 100%;">
                                                        <RadzenTextArea @bind-Value="currentComment.Text" Rows="4" Style="width: 100%;" Placeholder="Enter audit comment..." />
                                                    </RadzenFormField>
                                                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                                                        <RadzenCheckBox @bind-Value="lodCase.IsAudited" />
                                                        <RadzenLabel Text="Mark as Audited" />
                                                    </RadzenStack>
                                                    <RadzenFormField Text="Point of Contact" Style="width: 100%;">
                                                        <RadzenTextBox @bind-Value="lodCase.PointOfContact" Placeholder="e.g., AF/A1PP email" />
                                                    </RadzenFormField>
                                                </RadzenStack>
                                            </RadzenFieldset>
                                            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.5rem" class="rz-mt-4">
                                                <RadzenButton ButtonType="ButtonType.Submit" Text="Add Comment" Icon="add_comment" />
                                            </RadzenStack>
                                        </RadzenTemplateForm>

                                        @if (lodCase.AuditComments.Any())
                                        {
                                            <RadzenFieldset Text="Audit Comments" class="rz-mt-4">
                                                <RadzenDataList Data="@lodCase.AuditComments" TItem="string">
                                                    <Template Context="comment">
                                                        <RadzenCard Variant="Variant.Outlined" class="rz-mb-2">
                                                            <RadzenText TextStyle="TextStyle.Body2">@comment</RadzenText>
                                                        </RadzenCard>
                                                    </Template>
                                                </RadzenDataList>
                                            </RadzenFieldset>
                                        }
                                    </div>
                                </RadzenTabsItem>
                            </Tabs>
                        </RadzenTabs>
                    </div>
                </RadzenStepsItem>

                @* ═══════════════════ Step 3: Timeline & Appeals ═══════════════════ *@
                <RadzenStepsItem Text="Timeline & Appeals">
                    <div class="step-content">
                        <RadzenTabs @bind-SelectedIndex="step3TabIndex" RenderMode="TabRenderMode.Client">
                            <Tabs>
                                @* ───── Timeline Steps Tab ───── *@
                                <RadzenTabsItem Text="Timeline Steps" Icon="timeline">
                                    <div class="tab-content">
                                        <RadzenTemplateForm TItem="TimelineStep" Data="@currentTimelineStep" Submit="@OnTimelineStepSubmit">
                                            <RadzenFieldset Text="Add Timeline Step">
                                                <RadzenStack Gap="1rem">
                                                    <RadzenFormField Text="Step Description" Style="width: 100%;">
                                                        <RadzenTextBox @bind-Value="currentTimelineStep.StepDescription" Placeholder="e.g., Member Reports, Medical Provider Review" />
                                                    </RadzenFormField>
                                                    <RadzenRow Gap="1rem">
                                                        <RadzenColumn Size="12" SizeMD="4">
                                                            <RadzenFormField Text="Timeline Days" Style="width: 100%;">
                                                                <RadzenNumeric @bind-Value="currentTimelineStep.TimelineDays" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="4">
                                                            <RadzenFormField Text="Start Date" Style="width: 100%;">
                                                                <RadzenDatePicker @bind-Value="currentTimelineStep.StartDate" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="4">
                                                            <RadzenFormField Text="Completion Date" Style="width: 100%;">
                                                                <RadzenDatePicker @bind-Value="currentTimelineStep.CompletionDate" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                    </RadzenRow>
                                                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                                                        <RadzenCheckBox @bind-Value="currentTimelineStep.IsOptional" />
                                                        <RadzenLabel Text="Optional Step" />
                                                    </RadzenStack>
                                                </RadzenStack>
                                            </RadzenFieldset>
                                            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.5rem" class="rz-mt-4">
                                                <RadzenButton ButtonType="ButtonType.Submit" Text="Add Step" Icon="add" />
                                            </RadzenStack>
                                        </RadzenTemplateForm>

                                        @if (lodCase.TimelineSteps.Any())
                                        {
                                            <RadzenFieldset Text="Existing Steps" class="rz-mt-4">
                                                <RadzenDataList Data="@lodCase.TimelineSteps" TItem="TimelineStep">
                                                    <Template Context="step">
                                                        <RadzenCard Variant="Variant.Outlined" class="rz-mb-2">
                                                            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
                                                                <RadzenStack Gap="0.25rem">
                                                                    <RadzenText TextStyle="TextStyle.Subtitle1"><strong>@step.StepDescription</strong></RadzenText>
                                                                    <RadzenText TextStyle="TextStyle.Caption" Style="color: var(--rz-text-secondary-color);">
                                                                        @step.TimelineDays days @(step.IsOptional ? "(Optional)" : "")
                                                                    </RadzenText>
                                                                </RadzenStack>
                                                                <RadzenBadge Text="@(step.CompletionDate?.ToString("d") ?? "Pending")"
                                                                             BadgeStyle="@(step.CompletionDate.HasValue ? BadgeStyle.Success : BadgeStyle.Warning)" />
                                                            </RadzenStack>
                                                        </RadzenCard>
                                                    </Template>
                                                </RadzenDataList>
                                            </RadzenFieldset>
                                        }
                                    </div>
                                </RadzenTabsItem>

                                @* ───── Appeals Tab ───── *@
                                <RadzenTabsItem Text="Appeals" Icon="gavel">
                                    <div class="tab-content">
                                        <RadzenTemplateForm TItem="LODAppeal" Data="@currentAppeal" Submit="@OnAppealSubmit">
                                            <RadzenFieldset Text="Add Appeal">
                                                <RadzenStack Gap="1rem">
                                                    <RadzenRow Gap="1rem">
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="Appeal Date" Style="width: 100%;">
                                                                <RadzenDatePicker @bind-Value="currentAppeal.AppealDate" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="Appellant" Style="width: 100%;">
                                                                <RadzenTextBox @bind-Value="currentAppeal.Appellant" Placeholder="Member or Next of Kin" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                    </RadzenRow>
                                                    <RadzenRow Gap="1rem">
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="Original Finding" Style="width: 100%;">
                                                                <RadzenDropDown @bind-Value="currentAppeal.OriginalFinding" Data="@lodFindings"
                                                                                TextProperty="Text" ValueProperty="Value" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="Appeal Outcome" Style="width: 100%;">
                                                                <RadzenDropDown @bind-Value="currentAppeal.AppealOutcome" Data="@lodFindings"
                                                                                TextProperty="Text" ValueProperty="Value" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                    </RadzenRow>
                                                    <RadzenFormField Text="Resolution Date" Style="width: 100%;">
                                                        <RadzenDatePicker @bind-Value="currentAppeal.ResolutionDate" Style="width: 100%;" />
                                                    </RadzenFormField>
                                                </RadzenStack>
                                            </RadzenFieldset>
                                            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.5rem" class="rz-mt-4">
                                                <RadzenButton ButtonType="ButtonType.Submit" Text="Add Appeal" Icon="add" />
                                            </RadzenStack>
                                        </RadzenTemplateForm>

                                        @if (lodCase.Appeals.Any())
                                        {
                                            <RadzenFieldset Text="Existing Appeals" class="rz-mt-4">
                                                <RadzenDataList Data="@lodCase.Appeals" TItem="LODAppeal">
                                                    <Template Context="appeal">
                                                        <RadzenCard Variant="Variant.Outlined" class="rz-mb-2">
                                                            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
                                                                <RadzenStack Gap="0.25rem">
                                                                    <RadzenText TextStyle="TextStyle.Subtitle1"><strong>@appeal.Appellant</strong></RadzenText>
                                                                    <RadzenText TextStyle="TextStyle.Body2">@appeal.OriginalFinding → @appeal.AppealOutcome</RadzenText>
                                                                </RadzenStack>
                                                                <RadzenBadge Text="@appeal.AppealDate.ToString("d")" BadgeStyle="BadgeStyle.Warning" />
                                                            </RadzenStack>
                                                        </RadzenCard>
                                                    </Template>
                                                </RadzenDataList>
                                            </RadzenFieldset>
                                        }
                                    </div>
                                </RadzenTabsItem>

                                @* ───── Comments Tab ───── *@
                                <RadzenTabsItem Text="Comments" Icon="comment">
                                    <div class="tab-content">
                                        <RadzenTemplateForm TItem="CommentModel" Data="@currentComment" Submit="@OnCommentSubmit">
                                            <RadzenFieldset Text="Add Comment">
                                                <RadzenStack Gap="1rem">
                                                    <RadzenFormField Text="Comment" Style="width: 100%;">
                                                        <RadzenTextArea @bind-Value="currentComment.Text" Rows="4" Style="width: 100%;" Placeholder="Enter audit comment..." />
                                                    </RadzenFormField>
                                                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                                                        <RadzenCheckBox @bind-Value="lodCase.IsAudited" />
                                                        <RadzenLabel Text="Mark as Audited" />
                                                    </RadzenStack>
                                                    <RadzenFormField Text="Point of Contact" Style="width: 100%;">
                                                        <RadzenTextBox @bind-Value="lodCase.PointOfContact" Placeholder="e.g., AF/A1PP email" />
                                                    </RadzenFormField>
                                                </RadzenStack>
                                            </RadzenFieldset>
                                            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.5rem" class="rz-mt-4">
                                                <RadzenButton ButtonType="ButtonType.Submit" Text="Add Comment" Icon="add_comment" />
                                            </RadzenStack>
                                        </RadzenTemplateForm>

                                        @if (lodCase.AuditComments.Any())
                                        {
                                            <RadzenFieldset Text="Audit Comments" class="rz-mt-4">
                                                <RadzenDataList Data="@lodCase.AuditComments" TItem="string">
                                                    <Template Context="comment">
                                                        <RadzenCard Variant="Variant.Outlined" class="rz-mb-2">
                                                            <RadzenText TextStyle="TextStyle.Body2">@comment</RadzenText>
                                                        </RadzenCard>
                                                    </Template>
                                                </RadzenDataList>
                                            </RadzenFieldset>
                                        }
                                    </div>
                                </RadzenTabsItem>
                            </Tabs>
                        </RadzenTabs>
                    </div>
                </RadzenStepsItem>

                @* ═══════════════════ Step 4: Findings ═══════════════════ *@
                <RadzenStepsItem Text="Findings">
                    <div class="step-content">
                        <RadzenTabs @bind-SelectedIndex="step4TabIndex" RenderMode="TabRenderMode.Client">
                            <Tabs>
                                @* ───── Findings Tab ───── *@
                                <RadzenTabsItem Text="Findings" Icon="fact_check">
                                    <div class="tab-content">
                                        <RadzenTemplateForm TItem="LODCase" Data="@lodCase" Submit="@OnSubmit">
                                            <RadzenFieldset Text="LOD Findings & Determinations">
                                                <RadzenStack Gap="1rem">
                                                    <RadzenRow Gap="1rem">
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="Final Finding" Style="width: 100%;">
                                                                <RadzenDropDown @bind-Value="lodCase.FinalFinding" Data="@lodFindings"
                                                                                TextProperty="Text" ValueProperty="Value" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="Years of Service" Style="width: 100%;">
                                                                <RadzenNumeric @bind-Value="lodCase.YearsOfService" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                    </RadzenRow>
                                                    <RadzenFormField Text="Proximate Cause (for NILOD)" Style="width: 100%;">
                                                        <RadzenTextArea @bind-Value="lodCase.ProximateCause" Rows="3" Style="width: 100%;" />
                                                    </RadzenFormField>
                                                    <RadzenRow Gap="1rem">
                                                        <RadzenColumn Size="12" SizeMD="4">
                                                            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                                                                <RadzenCheckBox @bind-Value="lodCase.IsPriorServiceCondition" />
                                                                <RadzenLabel Text="Prior Service Condition" />
                                                            </RadzenStack>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="4">
                                                            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                                                                <RadzenCheckBox @bind-Value="lodCase.EightYearRuleApplies" />
                                                                <RadzenLabel Text="8-Year Rule Applies" />
                                                            </RadzenStack>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="4">
                                                            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                                                                <RadzenCheckBox @bind-Value="lodCase.IsInterimLOD" />
                                                                <RadzenLabel Text="Interim LOD" />
                                                            </RadzenStack>
                                                        </RadzenColumn>
                                                    </RadzenRow>
                                                    <RadzenFormField Text="PSC Documentation" Style="width: 100%;">
                                                        <RadzenTextArea @bind-Value="lodCase.PSCDocumentation" Rows="2" Style="width: 100%;" />
                                                    </RadzenFormField>
                                                    <RadzenRow Gap="1rem">
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="Initiation Date" Style="width: 100%;">
                                                                <RadzenDatePicker @bind-Value="lodCase.InitiationDate" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="Completion Date" Style="width: 100%;">
                                                                <RadzenDatePicker @bind-Value="lodCase.CompletionDate" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                    </RadzenRow>
                                                    <RadzenFormField Text="Interim LOD Expiration" Style="width: 100%;">
                                                        <RadzenDatePicker @bind-Value="lodCase.InterimLODExpiration" Style="width: 100%;" />
                                                    </RadzenFormField>
                                                    <RadzenFormField Text="Total Timeline Days" Style="width: 100%;">
                                                        <RadzenNumeric @bind-Value="lodCase.TotalTimelineDays" Style="width: 100%;" />
                                                    </RadzenFormField>
                                                </RadzenStack>
                                            </RadzenFieldset>
                                            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.5rem" class="rz-mt-4">
                                                <RadzenButton ButtonType="ButtonType.Submit" Text="Save" Icon="save" />
                                            </RadzenStack>
                                        </RadzenTemplateForm>
                                    </div>
                                </RadzenTabsItem>

                                @* ───── Comments Tab ───── *@
                                <RadzenTabsItem Text="Comments" Icon="comment">
                                    <div class="tab-content">
                                        <RadzenTemplateForm TItem="CommentModel" Data="@currentComment" Submit="@OnCommentSubmit">
                                            <RadzenFieldset Text="Add Comment">
                                                <RadzenStack Gap="1rem">
                                                    <RadzenFormField Text="Comment" Style="width: 100%;">
                                                        <RadzenTextArea @bind-Value="currentComment.Text" Rows="4" Style="width: 100%;" Placeholder="Enter audit comment..." />
                                                    </RadzenFormField>
                                                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                                                        <RadzenCheckBox @bind-Value="lodCase.IsAudited" />
                                                        <RadzenLabel Text="Mark as Audited" />
                                                    </RadzenStack>
                                                    <RadzenFormField Text="Point of Contact" Style="width: 100%;">
                                                        <RadzenTextBox @bind-Value="lodCase.PointOfContact" Placeholder="e.g., AF/A1PP email" />
                                                    </RadzenFormField>
                                                </RadzenStack>
                                            </RadzenFieldset>
                                            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.5rem" class="rz-mt-4">
                                                <RadzenButton ButtonType="ButtonType.Submit" Text="Add Comment" Icon="add_comment" />
                                            </RadzenStack>
                                        </RadzenTemplateForm>

                                        @if (lodCase.AuditComments.Any())
                                        {
                                            <RadzenFieldset Text="Audit Comments" class="rz-mt-4">
                                                <RadzenDataList Data="@lodCase.AuditComments" TItem="string">
                                                    <Template Context="comment">
                                                        <RadzenCard Variant="Variant.Outlined" class="rz-mb-2">
                                                            <RadzenText TextStyle="TextStyle.Body2">@comment</RadzenText>
                                                        </RadzenCard>
                                                    </Template>
                                                </RadzenDataList>
                                            </RadzenFieldset>
                                        }
                                    </div>
                                </RadzenTabsItem>
                            </Tabs>
                        </RadzenTabs>
                    </div>
                </RadzenStepsItem>

                @* ═══════════════════ Step 5: Benefits ═══════════════════ *@
                <RadzenStepsItem Text="Benefits">
                    <div class="step-content">
                        <RadzenTabs @bind-SelectedIndex="step5TabIndex" RenderMode="TabRenderMode.Client">
                            <Tabs>
                                @* ───── MedCon Details Tab ───── *@
                                <RadzenTabsItem Text="MedCon Details" Icon="medical_services">
                                    <div class="tab-content">
                                        <RadzenTemplateForm TItem="MEDCONDetails" Data="@lodCase.MEDCON" Submit="@OnMedconSubmit">
                                            <RadzenFieldset Text="MEDCON (Medical Continuation)">
                                                <RadzenStack Gap="1rem">
                                                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                                                        <RadzenCheckBox @bind-Value="lodCase.MEDCON.IsEligible" />
                                                        <RadzenLabel Text="Eligible for MEDCON" />
                                                    </RadzenStack>
                                                    <RadzenRow Gap="1rem">
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="Start Date" Style="width: 100%;">
                                                                <RadzenDatePicker @bind-Value="lodCase.MEDCON.StartDate" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="End Date" Style="width: 100%;">
                                                                <RadzenDatePicker @bind-Value="lodCase.MEDCON.EndDate" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                    </RadzenRow>
                                                    <RadzenRow Gap="1rem">
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="Extension Days" Style="width: 100%;">
                                                                <RadzenNumeric @bind-Value="lodCase.MEDCON.ExtensionDays" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenStack Gap="0.75rem" Style="padding-top: 0.5rem;">
                                                                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                                                                    <RadzenCheckBox @bind-Value="lodCase.MEDCON.UsesInterimLOD" />
                                                                    <RadzenLabel Text="Uses Interim LOD" />
                                                                </RadzenStack>
                                                                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                                                                    <RadzenCheckBox @bind-Value="lodCase.MEDCON.OutOfLocalAreaLeaveApproved" />
                                                                    <RadzenLabel Text="Out-of-Area Leave Approved" />
                                                                </RadzenStack>
                                                            </RadzenStack>
                                                        </RadzenColumn>
                                                    </RadzenRow>
                                                    <RadzenFormField Text="Treatment Plan" Style="width: 100%;">
                                                        <RadzenTextArea @bind-Value="lodCase.MEDCON.TreatmentPlan" Rows="3" Style="width: 100%;" />
                                                    </RadzenFormField>
                                                    <RadzenFormField Text="Physician Memo" Style="width: 100%;">
                                                        <RadzenTextArea @bind-Value="lodCase.MEDCON.PhysicianMemo" Rows="3" Style="width: 100%;" />
                                                    </RadzenFormField>
                                                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                                                        <RadzenCheckBox @bind-Value="lodCase.MemberChoseMEDCON" />
                                                        <RadzenLabel Text="Member Chose MEDCON (if eligible for both)" />
                                                    </RadzenStack>
                                                </RadzenStack>
                                            </RadzenFieldset>
                                            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.5rem" class="rz-mt-4">
                                                <RadzenButton ButtonType="ButtonType.Submit" Text="Save" Icon="save" />
                                            </RadzenStack>
                                        </RadzenTemplateForm>
                                    </div>
                                </RadzenTabsItem>

                                @* ───── INCAP Details Tab ───── *@
                                <RadzenTabsItem Text="INCAP Details" Icon="payments">
                                    <div class="tab-content">
                                        <RadzenTemplateForm TItem="INCAPDetails" Data="@lodCase.INCAP" Submit="@OnIncapSubmit">
                                            <RadzenFieldset Text="INCAP (Incapacitation Pay)">
                                                <RadzenStack Gap="1rem">
                                                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                                                        <RadzenCheckBox @bind-Value="lodCase.INCAP.IsEligible" />
                                                        <RadzenLabel Text="Eligible for INCAP Pay" />
                                                    </RadzenStack>
                                                    <RadzenFormField Text="Civilian Income Loss" Style="width: 100%;">
                                                        <RadzenNumeric @bind-Value="lodCase.INCAP.CivilianIncomeLoss" Style="width: 100%;" Format="c" />
                                                    </RadzenFormField>
                                                    <RadzenRow Gap="1rem">
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="Start Date" Style="width: 100%;">
                                                                <RadzenDatePicker @bind-Value="lodCase.INCAP.StartDate" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                        <RadzenColumn Size="12" SizeMD="6">
                                                            <RadzenFormField Text="End Date" Style="width: 100%;">
                                                                <RadzenDatePicker @bind-Value="lodCase.INCAP.EndDate" Style="width: 100%;" />
                                                            </RadzenFormField>
                                                        </RadzenColumn>
                                                    </RadzenRow>
                                                    <RadzenFormField Text="Documentation" Style="width: 100%;">
                                                        <RadzenTextArea @bind-Value="lodCase.INCAP.Documentation" Rows="4" Style="width: 100%;" Placeholder="Proof of income loss documentation..." />
                                                    </RadzenFormField>
                                                </RadzenStack>
                                            </RadzenFieldset>
                                            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.5rem" class="rz-mt-4">
                                                <RadzenButton ButtonType="ButtonType.Submit" Text="Save" Icon="save" />
                                            </RadzenStack>
                                        </RadzenTemplateForm>
                                    </div>
                                </RadzenTabsItem>

                                @* ───── Comments Tab ───── *@
                                <RadzenTabsItem Text="Comments" Icon="comment">
                                    <div class="tab-content">
                                        <RadzenTemplateForm TItem="CommentModel" Data="@currentComment" Submit="@OnCommentSubmit">
                                            <RadzenFieldset Text="Add Comment">
                                                <RadzenStack Gap="1rem">
                                                    <RadzenFormField Text="Comment" Style="width: 100%;">
                                                        <RadzenTextArea @bind-Value="currentComment.Text" Rows="4" Style="width: 100%;" Placeholder="Enter audit comment..." />
                                                    </RadzenFormField>
                                                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                                                        <RadzenCheckBox @bind-Value="lodCase.IsAudited" />
                                                        <RadzenLabel Text="Mark as Audited" />
                                                    </RadzenStack>
                                                    <RadzenFormField Text="Point of Contact" Style="width: 100%;">
                                                        <RadzenTextBox @bind-Value="lodCase.PointOfContact" Placeholder="e.g., AF/A1PP email" />
                                                    </RadzenFormField>
                                                </RadzenStack>
                                            </RadzenFieldset>
                                            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.5rem" class="rz-mt-4">
                                                <RadzenButton ButtonType="ButtonType.Submit" Text="Add Comment" Icon="add_comment" />
                                            </RadzenStack>
                                        </RadzenTemplateForm>

                                        @if (lodCase.AuditComments.Any())
                                        {
                                            <RadzenFieldset Text="Audit Comments" class="rz-mt-4">
                                                <RadzenDataList Data="@lodCase.AuditComments" TItem="string">
                                                    <Template Context="comment">
                                                        <RadzenCard Variant="Variant.Outlined" class="rz-mb-2">
                                                            <RadzenText TextStyle="TextStyle.Body2">@comment</RadzenText>
                                                        </RadzenCard>
                                                    </Template>
                                                </RadzenDataList>
                                            </RadzenFieldset>
                                        }
                                    </div>
                                </RadzenTabsItem>
                            </Tabs>
                        </RadzenTabs>
                    </div>
                </RadzenStepsItem>
            </Steps>
        </RadzenSteps>
    </div>
}
