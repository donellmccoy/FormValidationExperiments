@page "/case/create"

<PageTitle>Create Case - LOD Case Management</PageTitle>

@if (!isLoading && isBusy)
{
    <div style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.7);">
        <RadzenProgressBar Value="100" Mode="ProgressBarMode.Indeterminate" Style="width: 640px; height: 3px;" />
        <RadzenText TextStyle="TextStyle.Body2" Style="margin-top: 8px; color: var(--rz-text-color);">@busyMessage</RadzenText>
    </div>
}

@if (isLoading)
{
    <div class="loading-container">
        <RadzenStack Gap="1.5rem">
            <RadzenSkeleton Style="width: 300px; height: 28px;" Animation="SkeletonAnimation.Wave" />
            <RadzenSkeleton Style="width: 400px; height: 18px;" Animation="SkeletonAnimation.Wave" />
            <RadzenStack Gap="1rem">
                <RadzenSkeleton Style="width: 100%; height: 120px;" Animation="SkeletonAnimation.Wave" />
                <RadzenSkeleton Style="width: 100%; height: 100px;" Animation="SkeletonAnimation.Wave" />
                <RadzenSkeleton Style="width: 100%; height: 180px;" Animation="SkeletonAnimation.Wave" />
            </RadzenStack>
        </RadzenStack>
    </div>
}
else
{
    <RadzenBreadCrumb Style="margin-bottom: 0.75rem;">
        <RadzenBreadCrumbItem Path="/" Text="My Cases" />
        <RadzenBreadCrumbItem Text="Create New Case" />
    </RadzenBreadCrumb>

    @* ═══ Page Header ═══ *@
    <RadzenStack Gap="0.25rem" Style="margin-bottom: 1.5rem;">
        <RadzenText TextStyle="TextStyle.H4" Style="font-weight: 700; color: rgba(255, 255, 255, 0.87); margin: 0;">
            Create Line of Duty (LOD) Case
        </RadzenText>
        <RadzenText TextStyle="TextStyle.Body2" Style="color: rgba(255, 255, 255, 0.5); margin: 0;">
            Fill out the details below to initiate a new Line of Duty investigation.
        </RadzenText>
    </RadzenStack>

    <RadzenTemplateForm TItem="MemberInfoFormModel" Data="@memberFormModel" Submit="@OnSubmit">

        @* ═══ Section 1 — Search Member ═══ *@
        <RadzenCard class="rz-mb-4 section-card" Variant="Variant.Outlined">
            <RadzenStack Gap="1rem">
                <RadzenText TextStyle="TextStyle.H6" Style="font-weight: 700; color: rgba(255, 255, 255, 0.87); margin: 0;">
                    Search Member
                </RadzenText>
                <RadzenStack Gap="0.25rem">
                    <RadzenLabel Text="Search by Name, SSN, or DoD ID" />
                    <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem" AlignItems="AlignItems.End">
                        <RadzenTextBox @bind-Value="memberSearchText"
                                       Placeholder="Enter soldier's last name or identification number"
                                       Style="flex: 1;" @onkeydown="OnMemberSearchKeyDown" />
                        <RadzenButton Text="Search" Icon="search" ButtonStyle="ButtonStyle.Primary"
                                      Click="@OnMemberSearch" />
                    </RadzenStack>
                </RadzenStack>
            </RadzenStack>
        </RadzenCard>

        @* ═══ Section 2 — Case Details ═══ *@
        <RadzenCard class="rz-mb-4 section-card" Variant="Variant.Outlined">
            <RadzenStack Gap="1rem">
                <RadzenText TextStyle="TextStyle.H6" Style="font-weight: 700; color: rgba(255, 255, 255, 0.87); margin: 0;">
                    Case Details
                </RadzenText>
                <RadzenRow Gap="1rem">
                    <RadzenColumn Size="6">
                        <RadzenStack Gap="0.25rem">
                            <RadzenLabel Text="Incident Type" />
                            <RadzenDropDown TValue="IncidentType" @bind-Value="incidentType"
                                            Data="@incidentTypes" Placeholder="Select incident type..."
                                            Style="width: 100%;" />
                        </RadzenStack>
                    </RadzenColumn>
                    <RadzenColumn Size="6">
                        <RadzenStack Gap="0.25rem">
                            <RadzenLabel Text="Process Type" />
                            <RadzenDropDown TValue="LineOfDutyProcessType" @bind-Value="processType"
                                            Data="@processTypes" Placeholder="Select process type..."
                                            Style="width: 100%;" />
                        </RadzenStack>
                    </RadzenColumn>
                </RadzenRow>
            </RadzenStack>
        </RadzenCard>

        @* ═══ Section 3 — Member Identification ═══ *@
        <RadzenCard class="rz-mb-4 section-card" Variant="Variant.Outlined">
            <RadzenStack Gap="1rem">
                <RadzenText TextStyle="TextStyle.H6" Style="font-weight: 700; color: rgba(255, 255, 255, 0.87); margin: 0;">
                    Member Identification
                </RadzenText>
                <RadzenRow Gap="1rem">
                    <RadzenColumn Size="4">
                        <RadzenStack Gap="0.25rem">
                            <RadzenLabel Text="Rank" />
                            <RadzenDropDown TValue="MilitaryRank?" @bind-Value="memberFormModel.Rank"
                                            Data="@militaryRanks" Placeholder="Select..."
                                            Style="width: 100%;" />
                        </RadzenStack>
                    </RadzenColumn>
                    <RadzenColumn Size="4">
                        <RadzenStack Gap="0.25rem">
                            <RadzenLabel Text="First Name" />
                            <RadzenTextBox @bind-Value="memberFormModel.FirstName" Style="width: 100%;" />
                        </RadzenStack>
                    </RadzenColumn>
                    <RadzenColumn Size="4">
                        <RadzenStack Gap="0.25rem">
                            <RadzenLabel Text="Last Name" />
                            <RadzenTextBox @bind-Value="memberFormModel.LastName" Style="width: 100%;" />
                        </RadzenStack>
                    </RadzenColumn>
                </RadzenRow>
                <RadzenRow Gap="1rem">
                    <RadzenColumn Size="4">
                        <RadzenStack Gap="0.25rem">
                            <RadzenLabel Text="Full SSN" />
                            <RadzenTextBox Value="@memberFormModel.SSN" Change="@(args => OnSsnChanged(args))"
                                           MaxLength="11" Placeholder="XXX-XX-XXXX" Style="width: 100%;" />
                        </RadzenStack>
                    </RadzenColumn>
                    <RadzenColumn Size="4">
                        <RadzenStack Gap="0.25rem">
                            <RadzenLabel Text="DOD ID" />
                            <RadzenTextBox @bind-Value="dodId" Style="width: 100%;" />
                        </RadzenStack>
                    </RadzenColumn>
                    <RadzenColumn Size="4">
                        <RadzenStack Gap="0.25rem">
                            <RadzenLabel Text="Unit" />
                            <RadzenTextBox @bind-Value="memberFormModel.OrganizationUnit" Style="width: 100%;" />
                        </RadzenStack>
                    </RadzenColumn>
                </RadzenRow>
            </RadzenStack>
        </RadzenCard>

        @* ═══ Form Actions ═══ *@
        <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End" Gap="0.5rem">
            <RadzenButton Text="Cancel" ButtonStyle="ButtonStyle.Light" Variant="Variant.Outlined"
                          Click="@OnCancel" />
            <RadzenButton Text="Create Case" Icon="add" ButtonType="ButtonType.Submit"
                          ButtonStyle="ButtonStyle.Primary" />
        </RadzenStack>

    </RadzenTemplateForm>
}
