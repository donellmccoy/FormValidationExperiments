using Microsoft.AspNetCore.Http; using System.IO; using System.Text; using System.Threading.Tasks; namespace ECTSystem.Api.Middleware { public class RequestLoggingMiddleware { private readonly RequestDelegate _next; public RequestLoggingMiddleware(RequestDelegate next) { _next = next; } public async Task InvokeAsync(HttpContext context) { context.Request.EnableBuffering(); var requestBody = await new StreamReader(context.Request.Body).ReadToEndAsync(); context.Request.Body.Position = 0; System.Console.WriteLine($"REQUEST: {context.Request.Method} {context.Request.Path} {requestBody}"); var originalBodyStream = context.Response.Body; using var responseBody = new MemoryStream(); context.Response.Body = responseBody; await _next(context); context.Response.Body.Position = 0; var responseBodyText = await new StreamReader(context.Response.Body).ReadToEndAsync(); context.Response.Body.Position = 0; System.Console.WriteLine($"RESPONSE: {context.Response.StatusCode} {responseBodyText}"); await responseBody.CopyToAsync(originalBodyStream); } } }
